<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <style>
      table.borders-table {
        border-collapse: collapse;
        width: 80%;
      }
      table.borders-table th,
      table.borders-table td {
        border: 1px solid black;
        padding: 8px;
      }
    </style>

    <title>BabyJubjub 2021 Signature Suite</title>
    <script
      src="https://www.w3.org/Tools/respec/respec-w3c"
      class="remove"
      defer
    ></script>
    <script class="remove">
      var respecConfig = {
        specStatus: "ED",
        shortName: "BJJSignature2021",
        // group: "vc", // once we have W3C Community Group association uncomment this
        editors: [
          {
            name: "Ron Kahat",
            company: "Polygon",
            companyURL: "https://polygon.technology/polygon-id",
          },
        ],
        copyrightStart: "2021",
        xref: "web-platform",
        github: "https://github.com/tronch0/BJJSignature2021",
        doJsonLd: true,
        localBiblio:  {
          "RDF-DATASET-NORMALIZATION": {
            title:    "RDF Dataset Normalization 1.0",
            href:     "https://www.w3.org/TR/rdf-canon/",
            authors:  ["David Longley", "Manu Sporny"],
            status:   "CG-DRAFT",
            publisher:  "JSON-LD Community Group"
          },
          "GKR+19": {
            title:    "POSEIDON: A New Hash Function for Zero-Knowledge Proof Systems",
            href:     "https://eprint.iacr.org/2019/458.pdf", // https://spec.filecoin.io/algorithms/crypto/poseidon/
            authors:  ["Lorenzo Grassi", "Dmitry Khovratovich", "Christian Rechberger", "Arnab Roy", "Markus Schofnegger"],
            publisher:  "IACR"
          },
          "LD-SIGNATURES": {
            title:    "Linked Data Signatures 1.0",
            href:     "https://w3c-ccg.github.io/ld-signatures/",
            authors:  ["David Longley", "Manu Sporny"],
            status:   "CG-DRAFT",
            publisher:  "Digital Verification Community Group"
          },
          "BB19": {
            title:    "EdDSA For Baby Jubjub Elliptic Curve with MiMC-7 Hash",
            href:     "https://iden3-docs.readthedocs.io/en/latest/_downloads/a04267077fb3fdbf2b608e014706e004/Ed-DSA.pdf",
            authors:  ["Jordi Baylina", "Marta Bell√©s"]
          }
          // <td>signatureAlgorithm</td>
          //   <td><a href="https://eips.ethereum.org/EIPS/eip-2494">BabyJubJub</a></td>
          //   <td>[[EIP-2494]]</td>
        }
      };
    </script>
  </head>
  <body>
    <section id="abstract">
      <p>
        This specification describes the BabyJubjub 2021 Signature Suite, created in 2021 for the Verifiable Credentials Data Integrity Proof specification. The Signature Suite is designed to be zk-friendly, allowing the implementation of an additional security layer that can offer enhence privacy through zero-knowledge signature proofs.          
      </p>
    </section>

    <section id="sotd">
      <p>
        This document is a draft specification developed by Polygon and is provided for public review and feedback. The current version of the document is a work in progress and may be subject to changes or updates based on community input, technical advancements, or further research.

        The specification has not yet been submitted to, reviewed, or approved by any formal standards organization such as the W3C. However, it is intended to align closely with the existing W3C recommendations, specifications, and best practices related to decentralized identifiers, verifiable credentials, and digital signatures.      
      </p>
    </section>

    <section id="introduction">
      <h2>Introduction</h2>
      <p>
        This specification presents the BabyJubjub 2021 Signature Suite, created in 2021 for the Verifiable Credentials Data Integrity Proof specification. The suite employs EdDSA on the BabyJubJub curve as the signature algorithm, providing an efficient structure for signing and verifying credentials while being zk-friendly.

        Although the signature suite itself does not actively involve zero-knowledge proofs, its design is conducive to privacy-preserving computations and can be easily integrated with zkSNARKs and other zero-knowledge proof systems. This document details the components, structure, and implementation guidance for the BabyJubjub 2021 Signature Suite, catering to developers, implementers, and users.
            </p>
    </section>

    <section id="terminology">
        <h2>Terminology</h2>
        <p>
          The following terms are used to describe concepts involved in the
          generation and verification of the Linked Data Proof
          <a>signature suite</a>.
        </p>
  
        <dl>
          <dt><dfn>signature suite</dfn></dt>
          <dd>
            A specified set of cryptographic primitives typically consisting of a
            canonicalization algorithm, a message digest algorithm, and a
            signature algorithm that are bundled together by cryptographers for
            developers for the purposes of safety and convenience.
          </dd>
          <dt><dfn>canonicalization algorithm</dfn></dt>
          <dd>
            An algorithm that takes an input document that has more than one
            possible representation and always transforms it into a
            <a>canonical form</a>. This process is sometimes also called
            normalization.
          </dd>
          <dt>
            <dfn data-lt="message digest algorithm | message digest algorithms"
              >message digest algorithm</dfn
            >
          </dt>
          <dd>
            An algorithm that takes a message, preferably in some
            <a>canonical form</a> and produces a cryptographic output called a
            digest that is often many orders of magnitude smaller than the input
            message. These algorithms are often 1) very fast, 2) non-reversible,
            3) cause the output to change significantly when even one bit of the
            input message changes, and 4) make it infeasible to find two different
            inputs for the same output.
          </dd>
          <dt><dfn>canonical form</dfn></dt>
          <dd>
            The output of applying a <a>canonicalization algorithm</a> to an input
            document.
          </dd>
          <dt><dfn>signature algorithm</dfn></dt>
          <dd>
            An algorithm that takes an input message and produces an output value
            where the receiver of the message can mathematically verify that the
            message has not been modified in transit and came from someone
            possessing a particular secret.
          </dd>
          <dt>
            <dfn data-lt="linked data document|linked data documents"
              >linked data document</dfn
            >
          </dt>
          <dd>A document comprised of linked data.</dd>
          <dt>
            <dfn data-lt="linked data proof|linked data proofs"
              >linked data proof</dfn
            >
          </dt>
          <dd>
            A
            <a
              href="https://www.w3.org/TR/vc-data-integrity/#proofs"
              class="externalDFN"
              >proof</a
            >
            which is a set of attributes that represent a linked data digital
            proof and the parameters required to verify it as defined by
            RDF-N-Quads.
          </dd>
          <dt>linked data proof document</dt>
          <dd>
            A <a>linked data document</a> featuring one or more
            <a>linked data proofs</a>.
          </dd>
  
          <!-- <dt><dfn>JsonWebKey2020</dfn></dt>
          <dd>
            The <code>type</code> of the verification method for the signature
            suite <a>JsonWebSignature2020</a>.
          </dd> -->
  
          <dt><dfn>BJJSignature2021</dfn></dt>
          <dd>
            The <code>type</code> of the linked data proof for the signature suite
            BabyJubjub 2021.
          </dd>
        </dl>
      </section>

    <section id="suite-definition">
      <h2>Suite Definition</h2>
      <p>
        The BabyJubjub 2021 signature suite MUST be used in conjunction with the signing and verification algorithms in the Linked Data Signatures [[LD-SIGNATURES]] specification. The suite consists of the following algorithms:      
      </p>

      <table class="simple">
        <thead>
          <th>Parameter</th>
          <th>Value</th>
          <th>Specification</th>
        </thead>
        <tbody>
          <tr>
            <td>canonicalizationAlgorithm</td>
            <td>https://w3id.org/security#URDNA2015</td>
            <td>[[RDF-DATASET-NORMALIZATION]]</td>
          </tr>
          <tr>
            <td>digestAlgorithm</td>
            <td>Poseidon</td>
            <td>[[GKR+19]]</td>
          </tr>
          <tr>
            <td>signatureAlgorithm</td>
            <td>EdDSA-BabyJubJub</td>
            <td>[[BB19]]</td>
          </tr>
        </tbody>

      </table>

      <section id="modification-to-algorithms">
        <h3>Modification to Algorithms</h3>
        <p>
          The hash function in the <a>signature algorithm</a> has been repleaced to Poseidon[[GKR+19]] hash function.
        </p>

      </section>

      <section id="document-merklization-algorithm">
        <h3>Document Merklization Algorithm</h3>
        <p>
          The <a>signature suite</a> incorporates a document Merkleization algorithm to provide enhanced zero-knowledge compatibility support. This feature enables efficient querying of individual entries within JSON-LD documents in the context of zk-SNARK proofs. By constructing a Sparse Merkle Tree from the document, the algorithm supports selective disclosure of Verifiable Credential (VC) entries, efficiently prove membership, non-membership, and other predicate satisfactions related to the JSON-LD document, while maintaining the privacy and integrity of the data.  
         </p>
        <p>
          Prior to applying the Merkleization algorithm, the document must be in its expanded and canonicalized form.
        </p>
        <p>
          The Merklization algorithm works as follow:
          <ol>
            <li>Obtain a list of RDF Quads from the canonicalized document.</li>
            <li>For each Quad, construct a key-value pair where the key represents the complete type path, and the value corresponds to the entry's value. </li>
            <li>Insert each key-value pair into the Merkle Tree, with the key serving as the path in the tree and the leaf's value being the hash of the pair's value, computed using the designated <a>message digest algorithm</a>.
          </ol>
        </p>

        <p>For a detailed illustration of the Merkleization algorithm applied to a JSON-LD document, please refer to the example provided in the <a href="#document-merkleization">Examples</a> section of this document.</p>
        <!-- <p>
          By implementing this Merkleization algorithm, the signature suite offers a robust method for handling JSON-LD documents in a privacy-preserving and efficient manner, making it well-suited for various cryptographic applications.
        </p> -->

      </section>
      
      <section id="proof-generation-verification">
        <h3>Proof Generation and Verification</h3>

        <h4 id="proof-generation">Proof Generation Algorithm</h4>

        <p>
          The <a>BJJSignature2021</a> proof generation process follows a specific algorithm to ensure the integrity and authenticity of JSON-LD documents. The steps of the algorithm are as follows:
          <ol>
            <li>Expand the JSON-LD document using the <a href="https://www.w3.org/TR/json-ld11-api/#expansion">JSON-LD 1.1 Processing Algorithms.</a></li>
            <li>Canonicalize the document using the URDNA2015 algorithm [[RDF-DATASET-NORMALIZATION]].</li>
            <li>Apply the <a href="#document-merklization-algorithm">Document Merklization Algorithm</a> to create a Merkle tree from the canonicalized document.</li>
            <li>Sign the root of the document's Merkle tree using the associated private key.</li>
          </ol>
        </p>  

        <h4 id="proof-verification">Signature Verification Algorithm</h4>

        <p>
          The <a>BJJSignature2021</a> proof verification process utilizes the same technique as the <a href="#proof-generation">Proof Generation Algorithm</a>, ensuring the consistency and security of the JSON-LD documents. The steps for signature verification are as follows:
          <ol>
            <li>Expand the JSON-LD document using the <a href="https://www.w3.org/TR/json-ld11-api/#expansion">JSON-LD 1.1 Processing Algorithms</a></li>
            <li>Canonicalize the document using the URDNA2015 algorithm [[RDF-DATASET-NORMALIZATION]].</li>
            <li>Merklize the document using the <a href="#document-merklization-algorithm">Merklization Algorithm</a>.</li>
            <li>Veirify the signature agaisnt the root of the document's merkle tree and the public key.</li>
          </ol>
        </p>  
      </section>

      <!-- <section id="proof-representation">
        <h3>Proof Representation</h3>
        <p>
          Describe how proofs are represented and formatted within the signature suite.
        </p>
      </section> -->

      <section id="security-considerations">
        <h3>Security Considerations</h3>
        <p>
          When implementing the BabyJubjub 2021 Signature Suite, several security considerations must be taken into account to ensure the integrity, confidentiality, and availability of the system.
        </p>

        <section id="security-considerations-key-management">
          <h4>Key Management</h4>
          <p>
            Proper key management practices must be followed to ensure the security of private keys. This includes secure key generation, storage, and destruction. It is essential to protect private keys from unauthorized access, as the loss or compromise of a private key could lead to impersonation or unauthorized access to signed documents.
          </p>
        </section>

        <section id="security-considerations-cryptographic-security">
          <h4>Cryptographic Algorithms</h4>
          <p>
            The security of the BabyJubjub 2021 Signature Suite is dependent on the underlying cryptographic algorithms (Poseidon hash function and BabyJubJub signature algorithm). It is crucial to ensure that the chosen algorithms have been thoroughly analyzed and deemed secure by the cryptographic community.
          </p>
        </section>

        <section id="security-considerations-merkalization">
          <h4>Document Merklization</h4>
          <p>
            The Merklization process should be carefully implemented and reviewed to ensure that it preserves the integrity of the document while allowing for efficient zero-knowledge proofs. Any vulnerabilities in the Merklization algorithm could compromise the integrity of the signed document or the privacy of the zkSNARK proofs.
          </p>
        </section>

        <section id="security-considerations-side-channel">
          <h4>Side Channel Attacks</h4>
          <p>
            Implementations of the BabyJubjub 2021 Signature Suite should be designed to be resistant to side-channel attacks. These attacks could involve timing, power consumption, or electromagnetic radiation analysis to extract secret information from the system. Proper countermeasures should be employed to prevent such attacks.
          </p>
        </section>



      </section>

      <!-- <section id="privacy-considerations">
        <h3>Privacy Considerations</h3>
        <p>
          In the basic form of the BabyJubjub 2021 signature suite it provides the usual behvoir of a signature scheme, the prover needs to share with the verifier the document (aka the message), the signature and the public key of the issuer. 
          This signature suite was secialisy designed to be comptabily and effcient in a zkSNARK setting, due to this design choice we prove a valid signature from an issuer without disclosing the signature nor the document and enhance the holder privacy termndesulay.
          Address privacy concerns and provide recommendations on how to protect user privacy.
        </p>
      </section> -->

      <section id="examples">
        <h3>Examples</h3>
        <div class="issue">
          TODO: Add more examples
        </div>


        <h4>Document Merkleization</h4>
        <p>Consider the following JSON-LD document as an example:</p>
          <pre class="example"><code>
        {
          "@context": "http://schema.org/",
          "@type": "Person",
          "name": "Jane Doe",
          "jobTitle": "Professor",
          "telephone": "(425) 123-4567"
        }</code></pre>

        <p>After expanding and canonicalizing the JSON-LD document, we obtain the list of RDF Quads. The key-value pairs derived from these RDF Quads can be represented in the following table:</p>
    
        <table class="borders-table">
          <thead>
            <tr>
              <th>Path</th>
              <th>Value</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>http://schema.org/jobTitle</td>
              <td>Professor</td>
            </tr>
            <tr>
              <td>http://schema.org/name</td>
              <td>Jane Doe</td>
            </tr>
            <tr>
              <td>http://schema.org/telephone</td>
              <td>(425) 123-4567</td>
            </tr>
            <tr>
              <td>http://www.w3.org/1999/02/22-rdf-syntax-ns#type</td>
              <td>http://schema.org/Person</td>
            </tr>
          </tbody>
        </table>
    
        <p>Following the extraction of key-value pairs from the RDF Quads, we construct a Merkle tree using these pairs. Each key-value pair represents a leaf node in the Merkle tree, with the key being the path in the tree and the leaf's value being the hash of the pair's value.</p>

        <p>The following image represents the resulting Merkle tree constructed using the key-value pairs from the table above:</p>
        <img src="https://raw.githubusercontent.com/tronch0/BJJSignature2021/main/mt.png" style="max-width: 100%;" alt="Description of the image" />

      </section>
    </section>

    <section id="conformance">

    </section>

    <!-- <section id="references">
      <h2>References</h2>
      <p>
        List all relevant sources, including W3C specifications, academic papers, and other resources that have been referenced in the document.
      </p>
    </section> -->

  </body>
</html>
